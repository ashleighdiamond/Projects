{"paragraphs":[{"user":"anonymous","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1494457855705_-1906375840","id":"20170510-231055_763962437","dateCreated":"2017-05-10T23:10:55+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:5212","text":"%pyspark","dateUpdated":"2017-05-10T23:11:07+0000"},{"text":"%pyspark\nimport psycopg2\nfrom psycopg2 import IntegrityError, InternalError\n","user":"anonymous","dateUpdated":"2017-05-10T23:32:16+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1494457870029_-415827953","id":"20170510-231110_878445777","dateCreated":"2017-05-10T23:11:10+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:5274","dateFinished":"2017-05-10T23:32:16+0000","dateStarted":"2017-05-10T23:32:16+0000","results":{"code":"SUCCESS","msg":[]}},{"text":"%pyspark\nimport psycopg2\nfrom psycopg2 import IntegrityError, InternalError\n\n\ndef faster(source):\n    '''This function takes from my S3 bucket processes it, and then puts it into postgres'''\n    conn = psycopg2.connect(**{'dbname': '****', 'host': '****', 'password': '**', 'user': '**'})\n    cur = conn.cursor()\n    new=[]\n    count=0\n    for each in source:\n        new=each.split(\",\")\n        TransactionId=None\n        try :\n            TransactionId=int(new[2])\n        except:\n            pass\n        if TransactionId:\n            DataId=int(new[0])\n            MeterCode=int(new[1])\n            TransactionId=int(new[2])\n            TransactionDateTime=(new[3]).split(\" \")\n            Date=TransactionDateTime[0].split(\"/\")\n            Time=TransactionDateTime[1].split(\":\")\n            TDay=int(Date[1])\n            TMonth=int(Date[0])\n            TYear=int(Date[2])\n            THour=int(Time[0])\n            TMin=int(Time[1])\n            Amount=float(new[4])\n            PaymentMean=new[6]\n            PaidDuration=float(new[7])\n            ElementKey=int(new[8])\n\n            try:\n                cur.execute(\"INSERT INTO transactions (transactionid, dataid, metercode,amount,paymentmean, paidduration, elementKey, tday, tmonth, tyear, thour, tmin) VALUES (%s, %s, %s,%s,%s, %s, %s,%s,%s, %s, %s, %s)\", (TransactionId, DataId, MeterCode,Amount,PaymentMean, PaidDuration, ElementKey, TDay, TMonth, TYear, THour, TMin))\n                count+=1\n                if count>100:\n                    conn.commit()\n                    count=0\n            except (IntegrityError, InternalError) as e:  # prevents duplicates\n                cur.execute(\"rollback\")\n    conn.commit()\n    conn.close()","user":"anonymous","dateUpdated":"2017-05-11T08:07:48+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1494457880642_-1444261763","id":"20170510-231120_1246465278","dateCreated":"2017-05-10T23:11:20+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:5333","dateFinished":"2017-05-11T08:07:48+0000","dateStarted":"2017-05-11T08:07:48+0000","results":{"code":"SUCCESS","msg":[]}},{"text":"%pyspark\nrdd = sc.textFile('s3a://ashprojectbucket/*').cache()\nrdd.foreachPartition(faster)","user":"anonymous","dateUpdated":"2017-05-10T23:32:21+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"scala","editOnDblClick":false},"editorMode":"ace/mode/scala"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1494459080721_-959517543","id":"20170510-233120_303935229","dateCreated":"2017-05-10T23:31:20+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:5390","dateFinished":"2017-05-10T23:41:16+0000","dateStarted":"2017-05-10T23:32:21+0000","results":{"code":"SUCCESS","msg":[]}},{"text":"%pyspark\n","user":"anonymous","dateUpdated":"2017-05-10T23:32:21+0000","config":{"colWidth":12,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1494459141676_1955968415","id":"20170510-233221_953152061","dateCreated":"2017-05-10T23:32:21+0000","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:5473"}],"name":"Ashleigh_Project","id":"2CHT16NQW","angularObjects":{"2BRWU4WXC:shared_process":[],"2AM1YV5CU:shared_process":[],"2AJXGMUUJ:shared_process":[],"2ANGGHHMQ:shared_process":[],"2AKK3QQXU:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}